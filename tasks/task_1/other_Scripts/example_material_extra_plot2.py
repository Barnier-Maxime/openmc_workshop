#!/usr/bin/env python3

"""example_isotope_plot.py: plots cross sections for a couple of isotopes."""

__author__      = "Jonathan Shimwell"

import openmc
from plotly import __version__
from plotly.offline import download_plotlyjs, plot
from plotly.graph_objs import Scatter, Layout
import matplotlib.pyplot as plt
import re

from pyne import mcnp, nucname

def convert_zaids_to_names(zaids):
      names = []
      for item in zaids:                                             
            item_id = nucname.mcnp_to_id(item)
            name = nucname.name(item_id)
            #print(item, name)
            if name not in ['C12','C13','O18','Pt190','Pt192','Pt194','Pt195','Pt196','Pt198']: # I don't have these cross section
                  names.append(name)      
      return names



def generate_material_trace(mat,Endf_MT_number):
      if type(Endf_MT_number) == int:
            Endf_MT_number = [Endf_MT_number]
      Energy, data = openmc.calculate_cexs(mat, 'material', Endf_MT_number )
      cross_section = data[0]

      trace1= Scatter(x=Energy, 
                y=cross_section, 
                mode = 'lines', 
                name=mat.name + ' MT '+str(Endf_MT_number[0]) )
      return trace1

def make_material_from_name_afs(names,afs,number,name,density):
      breeder_material = openmc.Material(number, name)

      for name,af in zip(names,afs):
            print(name,af)
            breeder_material.add_nuclide(name, float(af), 'ao')

      breeder_material.set_density('g/cm3',density) 
      return breeder_material



hcpb_zaids = [26054,26056,26057,26058, 6012, 6013,25055,24050,24052,24053,24054,23050,23051,73180,73181,74180,74182,74183,74184,74186, 7014, 7015,22046,22047,22048,22049,22050,15031,14028,14029,14030,16032,16033,16034,16036,28058,28060,28061,28062,28064,42092,42094,42095,42096,42097,42098,42100,29063,29065,41093,13027, 5010, 5011,27059,33075,50112,50114,50115,50116,50117,50118,50119,50120,50122,50124,51121,51123,40090,40091,40092,40094,40096, 8016, 8017, 8018, 4009,12024,12025,12026,92234,92235,92238, 3006, 3007,20040,20042,20043,20044,20046,20048,19039,19040,19041,78190,78192,78194,78195,78196,78198,11023,30064,30066,30067,30068,30070,47107,47109,56130,56132,56134,56135,56136,56137,56138,48106,48108,48110,48111,48112,48113,48114,48116,82204,82206,82207,82208, 1001, 1002]
hcpb_names = convert_zaids_to_names(hcpb_zaids)
hcpb_afs =  [2.8511E-02,4.4756E-01,1.0336E-02,1.3755E-03,2.9100E-03,3.1474E-05,2.2413E-03,2.3095E-03,4.4536E-02,5.0500E-03,1.2571E-03,3.0140E-06,1.2026E-03,2.4462E-08,2.0366E-04,4.2753E-06,9.4413E-04,5.0983E-04,1.0916E-03,1.0129E-03,6.5543E-04,2.3945E-06,1.0601E-05,9.5604E-06,9.4730E-05,6.9519E-06,6.6563E-06,4.9776E-05,1.2744E-02,6.4742E-04,4.2729E-04,4.5532E-05,3.5950E-07,2.0372E-06,4.7933E-09,3.5672E-05,1.3741E-05,5.9729E-07,1.9045E-06,4.8495E-07,2.3729E-06,1.4943E-06,2.5869E-06,2.7224E-06,1.5678E-06,3.9832E-06,1.6037E-06,3.3467E-05,1.4931E-05,1.6560E-05,2.1407E-04,1.1305E-05,4.5504E-05,5.2713E-05,2.0496E-04,1.2546E-06,8.5365E-07,4.3976E-07,1.8806E-05,9.9333E-06,3.1326E-05,1.1110E-05,4.2139E-05,5.9885E-06,7.4888E-06,7.2142E-05,5.3958E-05,8.6692E-05,1.8905E-05,2.8897E-05,2.9285E-05,4.7179E-06,5.3139E-02,2.0242E-05,1.0920E-04,3.2315E-01,7.6979E-05,9.7454E-06,1.0730E-05,6.6906E-11,8.9257E-09,1.2300E-06,3.6014E-02,2.0584E-02,1.1565E-06,7.7184E-09,1.6105E-09,2.4885E-08,4.7718E-11,2.2308E-09,4.4321E-07,5.5604E-11,3.1985E-08,8.5301E-11,5.5588E-09,2.3358E-07,2.4012E-07,1.7920E-07,5.2290E-08,1.4785E-06,3.5110E-08,1.9800E-08,2.8847E-09,1.3174E-08,4.3557E-10,1.5250E-08,1.4168E-08,1.2247E-11,1.1669E-11,2.7925E-10,7.6161E-10,9.0742E-10,1.2977E-09,8.2837E-09,1.7643E-10,1.2562E-10,1.7629E-09,1.8066E-09,3.4058E-09,1.7248E-09,4.0551E-09,1.0572E-09,1.0720E-10,1.8453E-09,1.6922E-09,4.0122E-09,1.5739E-06,1.8102E-10]
hcpb_mat = make_material_from_name_afs(hcpb_names,hcpb_afs,1,'hcpb',3.44647)

wcll_zaids = [26054,26056,26057,26058, 6012, 6013,25055,24050,24052,24053,24054,23050,23051,73180,73181,74180,74182,74183,74184,74186, 7014, 7015,22046,22047,22048,22049,22050,15031,14028,14029,14030,16032,16033,16034,16036,28058,28060,28061,28062,28064,42092,42094,42095,42096,42097,42098,42100,29063,29065,41093,13027, 5010, 5011,27059,33075,50112,50114,50115,50116,50117,50118,50119,50120,50122,50124,51121,51123,40090,40091,40092,40094,40096, 8016, 8017, 8018, 1001, 1002, 3006, 3007,47107,47109,46102,46104,46105,46106,46108,46110,30064,30066,30067,30068,30070,83209,82204,82206,82207,82208,56130,56132,56134,56135,56136,56137,56138,20040,20042,20043,20044,20046,20048,48106,48108,48110,48111,48112,48113,48114,48116,19039,19040,19041,12024,12025,12026,11023]
wcll_names = convert_zaids_to_names(wcll_zaids)
wcll_afs = [2.3724E-02,3.7241E-01,8.6007E-03,1.1446E-03,2.3159E-03,2.5048E-05,1.9089E-03,1.9239E-03,3.7101E-02,4.2069E-03,1.0472E-03,2.6385E-06,1.0528E-03,2.0355E-08,1.6947E-04,3.9064E-06,8.6266E-04,4.6584E-04,9.9743E-04,9.2549E-04,5.4539E-04,1.9925E-06,8.8105E-06,7.9455E-06,7.8729E-05,5.7776E-06,5.5319E-06,4.1446E-05,5.9448E-04,3.0200E-05,1.9931E-05,3.7893E-05,2.9919E-07,1.6954E-06,3.9891E-09,6.0519E-05,2.3312E-05,1.0134E-06,3.2311E-06,8.2276E-07,6.0103E-06,3.7848E-06,6.5521E-06,6.8954E-06,3.9710E-06,1.0089E-05,4.0620E-06,3.3630E-05,1.5003E-05,1.9513E-05,2.9212E-04,9.4067E-06,3.7863E-05,4.3409E-05,1.7054E-04,1.9137E-06,1.3021E-06,6.7078E-07,2.8686E-05,1.5152E-05,4.7783E-05,1.6947E-05,6.4276E-05,9.1344E-06,1.1423E-05,6.0029E-05,4.4898E-05,7.2065E-05,1.5716E-05,2.4022E-05,2.4344E-05,3.9219E-06,7.6401E-02,2.9103E-05,1.5700E-04,1.5284E-01,1.7578E-05,4.9371E-02,4.7031E-03,2.5724E-06,2.3899E-06,5.1012E-08,5.5714E-07,1.1168E-06,1.3668E-06,1.3233E-06,5.8614E-07,4.0142E-06,2.2639E-06,3.2982E-07,1.5063E-06,4.9800E-08,5.0934E-05,3.5693E-03,6.1443E-02,5.6344E-02,1.3359E-01,1.1844E-11,1.1285E-11,2.7006E-10,7.3654E-10,8.7754E-10,1.2550E-09,8.0109E-09,3.7114E-08,2.4770E-10,5.1684E-11,7.9862E-10,1.5314E-12,7.1592E-11,1.7062E-10,1.2148E-10,1.7048E-09,1.7472E-09,3.2937E-09,1.6680E-09,3.9215E-09,1.0224E-09,7.3197E-08,9.1831E-12,5.2824E-09,4.9866E-08,6.3130E-09,6.9506E-09,1.3348E-07]
wcll_mat = make_material_from_name_afs(wcll_names,wcll_afs,2,'wcll',7.67136)



traces = []
traces.append(generate_material_trace(hcpb_mat,102))
traces.append(generate_material_trace(wcll_mat,102))

layout = {'title':'Element cross sections',
          'xaxis':{'title':'Energy (eV)',
                   #'range':(1e-10,14.1e6), 
                   'type':'log'
                  },
          'yaxis':{'title':'Macroscopic Cross Section (1/cm2)',
                   'type':'log'
                  },
         }

plot({'data':traces,
      'layout':layout})




